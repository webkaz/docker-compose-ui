version: '2'

services:

### Gitbucket ###
# 初期パスワード root/root
  gitbucket:
    links:
      - gitPosgre:postgresql
    container_name: gitbucket
    ports:
      - "29418:29418"
      - "8081:8080"
    environment:
      - VIRTUAL_HOST=gitbucket.*
      # ポートが複数開いている場合は、プロクシするポートを指定する必要あり
      - VIRTUAL_PORT=8080
    image: f99aq8ove/gitbucket
    # /gitbucket/repositories/ 配下にリポジトリができる。例 root/test.git
    volumes:
      - ../../mount/gitbucket:/gitbucket
      # gitリポジトリを参照させるためのVolume。
      - ../../mount/git:/gitbucket/repositories
    command: java -jar /opt/gitbucket.war --prefix=/gitbucket
    
  gitPosgre:
    container_name: gitPosgre
    image: sameersbn/postgresql:9.5-1
    environment:
      - DB_USER=gitbucket
      - DB_PASS=password
      - DB_NAME=gitbucket
    # dbはwinフォルダにマウントできない。
    volumes:
      - gitPosgre-data:/var/lib/postgresql
      - gitPosgre-run:/run/postgresql
      
# 名前付きボリュームの定義
volumes:
  ### Gitbucket ###
  gitPosgre-data:
  gitPosgre-run:

  



    